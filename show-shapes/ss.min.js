/*! 2013-11-01 */
(function(){function e(e){this.elem=e,this.style=getComputedStyle(e),this.unitsMap=this.generateUnitsMap(),this.bounds=this.generateBounds(),this.shapeInside=this.parseShape(this.getShapeInside()),this.shapeOutside=this.parseShape(this.getShapeOutside())}function t(e,t){return e.reduce(function(e,i){return e||t[i]},null)}function i(e,t,i){return e.reduce(function(e,n){return e||t[n]=i},null)}function n(e){return function(){return t(e,this.style)}}function s(e){return function(t){return i(e,this.elem.style,t)}}function o(e,t,i,n,s,o,r,l){if(e.beginPath(),r&&l){var h=.5522848,a=r*h,u=l*h;e.moveTo(i+r,n),e.lineTo(i+s-r,n),e.bezierCurveTo(i+s-r+a,n,i+s,n+l-u,i+s,n+l),e.lineTo(i+s,n+o-l),e.bezierCurveTo(i+s,n+o-l+u,i+s-r+a,n+o,i+s-r,n+o),e.lineTo(i+r,n+o),e.bezierCurveTo(i+r-a,n+o,i,n+o-l+u,i,n+o-l),e.lineTo(i,n+l),e.bezierCurveTo(i,n+l-u,i+r-a,n,i+r,n)}else e.moveTo(i,n),e.lineTo(i+s,n),e.lineTo(i+s,n+o),e.lineTo(i,n+o);e.closePath(),e.fillStyle=t,e.fill()}function r(e,t,i,n,s){e.beginPath(),e.arc(i,n,s,0,2*Math.PI),e.closePath(),e.fillStyle=t,e.fill()}function l(e,t,i,n,s,o){var r=.5522848,l=s*r,h=o*r;e.beginPath(),e.moveTo(i,n-o),e.bezierCurveTo(i+l,n-o,i+s,n-h,i+s,n),e.bezierCurveTo(i+s,n+h,i+l,n+o,i,n+o),e.bezierCurveTo(i-l,n+o,i-s,n+h,i-s,n),e.bezierCurveTo(i-s,n-h,i-l,n-o,i,n-o),e.closePath(),e.fillStyle=t,e.fill()}function h(e,t,i){e.beginPath(),i.forEach(function(t,i){i?e.lineTo(t.x,t.y):e.moveTo(t.x,t.y)}),e.closePath(),e.fillStyle=t,e.fill()}function a(e,t,i,n){var s;switch(i.shape){case"rectangle":o(e,n,t.x+i.x,t.y+i.y,i.width,i.height,i.rx,i.ry);break;case"circle":r(e,n,t.x+i.cx,t.y+i.cy,i.r);break;case"ellipse":l(e,n,t.x+i.cx,t.y+i.cy,i.rx,i.ry);break;case"polygon":s=i.points.map(function(e){return{x:e.x+t.x,y:e.y+t.y}}),h(e,n,s);break;default:o(e,n,t.x,t.y,t.width,t.height,0,0)}}function u(e,t){var i=t.shapeInside,n=t.shapeOutside,s=t.bounds;n&&a(e,s,n,"#1e90ff"),i&&a(e,s,i,"#43cd80")}function c(){var e=document.getElementById("show-shapes-canvas");e.width=document.documentElement.offsetWidth,e.height=document.documentElement.offsetHeight;var t=e.getContext("2d");t.fillRect(0,0,e.width,e.height,"rgba(0, 0, 0, 0.2)"),y.forEach(function(t){u(e.getContext("2d"),t)})}function d(){g?f():m(),g=!g}function p(e,t){for(var i in t)e.style[i]=t[i]}function m(){var t=document.createElement("div");t.id="show-shapes-overlay";var i={position:"absolute",top:"0",left:"0","z-index":"1040"};p(t,i);var n=document.createElement("button");n.innerHTML="close",i={position:"fixed",top:"1em",right:"1em"},p(n,i),n.onclick=d;var s=document.createElement("canvas");s.id="show-shapes-canvas";var i={opacity:"0.7"};p(s,i),t.appendChild(s),t.appendChild(n),document.body.appendChild(t),y=[];for(var o=document.getElementsByTagName("*"),r=0;o.length>r;r++){var l=o[r];e.hasShapes(l)&&y.push(new e(l))}window.addEventListener("resize",c,!1),c()}function f(){window.removeEventListener("resize",c);var e=document.getElementById("show-shapes-overlay");document.body.removeChild(e),y=[]}var v=["shapeInside","webkitShapeInside"],x=["shapeOutside","webkitShapeOutside"];e.hasShapes=function(e){var i=getComputedStyle(e);if(!i)return!1;var n=t(v,i),s=t(x,i);return n&&n.indexOf("(")>0||s&&s.indexOf("(")>0},e.prototype.getShapeInside=n(v),e.prototype.setShapeInside=s(v),e.prototype.getShapeOutside=n(x),e.prototype.setShapeOutside=s(x),e.prototype.generateUnitsMap=function(){var e=["em","ex","ch","rem","vw","vh","vmin","vmax","cm","mm","in","px","pt","pc"],t=document.createElement("div");this.elem.appendChild(t);var i=getComputedStyle(t),n={};return e.forEach(function(e){t.style.fontSize="1"+e,n[e]=parseFloat(i.fontSize)}),this.elem.removeChild(t),n},e.HORIZONTAL="horizontal",e.VERTICAL="vertical",e.prototype.toPixels=function(t,i){i===void 0&&(i=e.HORIZONTAL);var n;n=i===e.HORIZONTAL?this.bounds.width:i===e.VERTICAL?this.bounds.height:i;var s,o,r=/([\-0-9\.]*)([a-z%]*)/.exec(t);return s=parseFloat(r[1]),o=r[2],"%"===o?s*n/100:s*this.unitsMap[o]},e.prototype.generateBounds=function(){var e=this.elem.getBoundingClientRect(),e={x:e.left+document.documentElement.scrollLeft,y:e.top+document.documentElement.scrollTop,width:e.width,height:e.height};if("border-box"===this.style.boxSizing)return e;var t=this.elem.clientLeft,i=this.elem.clientTop;return e.x+=t,e.y+=i,e.width=this.elem.clientWidth,e.height=this.elem.clientHeight,e},e.prototype.parseShape=function(t){if(t=t.split(/[()]/),!(1>=t.length)){var i=t[0],n=t[1].split(",");n=n.map(function(e){return e.trim(0)});var s,o=this;switch(i){case"rectangle":s={shape:"rectangle",x:this.toPixels(n[0],e.HORIZONTAL),y:this.toPixels(n[1],e.VERTICAL),width:this.toPixels(n[2],e.HORIZONTAL),height:this.toPixels(n[3],e.VERTICAL),rx:5>n.length?0:this.toPixels(n[4],e.HORIZONTAL),ry:6>n.length?s.rx:this.toPixels(n[5],e.VERTICAL),bounds:this.bounds,element:this.elem};break;case"inset-rectangle":s={shape:"inset-rectangle",top:this.toPixels(n[0],e.VERTICAL),right:this.toPixels(n[1],e.HORIZONTAL),bottom:this.toPixels(n[2],e.VERTICAL),left:this.toPixels(n[3],e.HORIZONTAL),rx:5>n.length?0:this.toPixels(n[4],e.HORIZONTAL),ry:6>n.length?s.rx:this.toPixels(n[5],e.VERTICAL),bounds:this.bounds,element:this.elem};break;case"circle":s={shape:"circle",cx:this.toPixels(n[0],e.HORIZONTAL),cy:this.toPixels(n[1],e.VERTICAL),r:this.toPixels(n[2],Math.sqrt((e.HORIZONTAL*e.HORIZONTAL+e.VERTICAL*e.VERTICAL)/2)),bounds:this.bounds,element:this.elem};break;case"ellipse":s={shape:"ellipse",cx:this.toPixels(n[0],e.HORIZONTAL),cy:this.toPixels(n[1],e.VERTICAL),rx:this.toPixels(n[2],e.HORIZONTAL),ry:this.toPixels(n[3],e.VERTICAL),bounds:this.bounds,element:this.elem};break;case"polygon":s={shape:"polygon",fillRule:n[0].search(/nonzero|evenodd/i)>=0?n.shift():"nonzero",points:n.map(function(t){return t=t.split(/\s+/),{x:o.toPixels(t[0],e.HORIZONTAL),y:o.toPixels(t[1],e.VERTICAL)}}),bounds:this.bounds,element:this.elem};break;case"url":s={shape:"image",url:n[0],bounds:this.bounds,element:this.elem};break;default:s=null}return s}};var y=[],g=!1;window.ShowShapes={toggleOverlay:d,ShapeInfo:e}})();