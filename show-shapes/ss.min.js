/*! 2014-02-10 */
var ShowShapes=function(){function e(e){return e&&e.text&&e.units&&e.borderBox&&e.margins&&e.borders&&e.paddings?(this.url=this.parseUrl(e.text),this.box=this.parseBox(this.url?"content-box":e.text,e.borderBox,e.margins,e.borders,e.paddings),this.shape=this.parseBasicShape(e.text,this.box,e.units),void 0):(console.log("Not all parameters were specified to ShapeValue, supplying dummy data"),void 0)}function t(e,t,i){var s=i.reduce(function(e,t){return e+t[0]},0),n=i.reduce(function(e,t){return e+t[1]},0),r=i.reduce(function(e,t){return e+t[2]},0),o=i.reduce(function(e,t){return e+t[3]},0);e.x-=t*o,e.y-=t*s,e.width+=t*(o+n),e.height+=t*(s+r)}function i(e,t,i){var s=i.reduce(function(e,t){return e+t[0]},0),n=i.reduce(function(e,t){return e+t[1]},0),r=i.reduce(function(e,t){return e+t[2]},0),o=i.reduce(function(e,t){return e+t[3]},0);e[0][0]=Math.max(e[0][0]+t*o,0),e[0][1]=Math.max(e[0][1]+t*s,0),e[1][0]=Math.max(e[1][0]+t*n,0),e[1][1]=Math.max(e[1][1]+t*s,0),e[2][0]=Math.max(e[2][0]+t*n,0),e[2][1]=Math.max(e[2][1]+t*r,0),e[3][0]=Math.max(e[3][0]+t*o,0),e[3][1]=Math.max(e[3][1]+t*r,0)}function s(e,t){return e.map(function(e){return e[t]})}function n(e,t,i){var s=/([\-0-9\.]*)([a-z%]*)/.exec(e);return s[1]=parseFloat(s[1]),s[2]?"%"===s[2]?s[1]*t/100:s[1]*i[s[2]]:s[1]}function r(e,t,i){e=e.split(/\s+/);var s="TopLeft",r=0;switch(e[0]){case"top":case"left":break;case"bottom":case"right":s="BottomRight";break;case"center":r=t/2;break;default:r=n(e[0],t,i)}return e.length>1&&(r=n(e[1],t,i)),"TopLeft"===s?r:t-r}function o(e,t,i,s){return"closest-side"===e?Math.min.apply(null,t):"farthest-side"===e?Math.max.apply(null,t):n(e,i,s)}function a(e,t){return/^(?:inset|circle|ellipse|polygon)\(.*\)$/.test(e)?e+" "+t:e}function h(t,i,s){i||(i=0),s||(s=0),this.elem=t,this.style=getComputedStyle(t),this.borderBox={x:0,y:0,width:t.offsetWidth,height:t.offsetHeight,radii:[[0,0],[0,0],[0,0],[0,0]]},this.unitsMap=this.generateUnitsMap();var r=this,o=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"];o.forEach(function(e,t){e=r.style[e].split(/\s+/),r.borderBox.radii[t][0]=n(e[0],r.borderBox.width,r.unitsMap),r.borderBox.radii[t][1]=n(e.length>1?e[1]:e[0],r.borderBox.height,r.unitsMap)});var h=function(e){return parseInt(e)};this.margins=[this.style.marginTop,this.style.marginRight,this.style.marginBottom,this.style.marginLeft],this.margins=this.margins.map(h),this.borders=[this.style.borderTop,this.style.borderRight,this.style.borderBottom,this.style.borderLeft],this.borders=this.borders.map(h),this.paddings=[this.style.paddingTop,this.style.paddingRight,this.style.paddingBottom,this.style.paddingLeft],this.paddings=this.paddings.map(h);var p={units:this.unitsMap,borderBox:this.borderBox,margins:this.margins,borders:this.borders,paddings:this.paddings};this.bounds=this.generateBounds(i,s),p.text=a(this.getShapeInside(),"content-box"),this.shapeInside=new e(p),p.text=a(this.getShapeOutside(),"margin-box"),this.shapeOutside=new e(p)}function p(e,t){return e.reduce(function(e,i){return e||t[i]},null)}function l(e){return function(){return p(e,this.style)}}function c(e,t,i,s,n,r,o){if(e.beginPath(),o){var a=.5522848,h=o[0][0],p=o[0][1],l=h*a,c=p*a;e.moveTo(i,s+r-o[3][1]),e.lineTo(i,s+p),e.bezierCurveTo(i,s+p-c,i+h-l,s,i+h,s),h=o[1][0],p=o[1][1],l=h*a,c=p*a,e.lineTo(i+n-h,s),e.bezierCurveTo(i+n-h+l,s,i+n,s+p-c,i+n,s+p),h=o[2][0],p=o[2][1],l=h*a,c=p*a,e.lineTo(i+n,s+r-p),e.bezierCurveTo(i+n,s+r-p+c,i+n-h+l,s+r,i+n-h,s+r),h=o[3][0],p=o[3][1],l=h*a,c=p*a,e.lineTo(i+h,s+r),e.bezierCurveTo(i+h-l,s+r,i,s+r-p+c,i,s+r-p)}else e.moveTo(i,s),e.lineTo(i+n,s),e.lineTo(i+n,s+r),e.lineTo(i,s+r);e.closePath(),e.fillStyle=t,e.fill()}function d(e,t,i,s,n){e.beginPath(),e.arc(i,s,n,0,2*Math.PI),e.closePath(),e.fillStyle=t,e.fill()}function u(e,t,i,s,n,r){var o=.5522848,a=n*o,h=r*o;e.beginPath(),e.moveTo(i,s-r),e.bezierCurveTo(i+a,s-r,i+n,s-h,i+n,s),e.bezierCurveTo(i+n,s+h,i+a,s+r,i,s+r),e.bezierCurveTo(i-a,s+r,i-n,s+h,i-n,s),e.bezierCurveTo(i-n,s-h,i-a,s-r,i,s-r),e.closePath(),e.fillStyle=t,e.fill()}function f(e,t,i){e.beginPath(),i.forEach(function(t,i){i?e.lineTo(t.x,t.y):e.moveTo(t.x,t.y)}),e.closePath(),e.fillStyle=t,e.fill()}function g(e,t,i,s){var n;if(i.shape)switch(i.shape.type){case"inset":c(e,s,t.x+i.shape.x+i.box.x,t.y+i.shape.y+i.box.y,i.shape.width,i.shape.height,i.shape.radii);break;case"circle":d(e,s,t.x+i.shape.cx+i.box.x,t.y+i.shape.cy+i.box.y,i.shape.r);break;case"ellipse":u(e,s,t.x+i.shape.cx+i.box.x,t.y+i.shape.cy+i.box.y,i.shape.rx,i.shape.ry);break;case"polygon":n=i.shape.points.map(function(e){return{x:e.x+t.x+i.box.x,y:e.y+t.y+i.box.y}}),f(e,s,n);break;default:}else i.box&&c(e,s,t.x+i.box.x,t.y+i.box.y,i.box.width,i.box.height,i.box.radii)}function x(e,t){var i=t.shapeInside,s=t.shapeOutside,n=t.bounds;s&&g(e,n,s,"#1e90ff"),i&&g(e,n,i,"#43cd80")}function y(){var e=document.getElementById("show-shapes-canvas");e.width=document.documentElement.offsetWidth,e.height=document.documentElement.offsetHeight;var t=e.getContext("2d");t.fillRect(0,0,e.width,e.height,"rgba(0, 0, 0, 0.2)"),M.forEach(function(t){x(e.getContext("2d"),t)})}function b(){C?T():w(),C=!C}function m(e,t){for(var i in t)e.style[i]=t[i]}function v(e,t,i){for(var s=[],n=e.getElementsByTagName("*"),r=0;n.length>r;r++){var o=n[r];h.hasShapes(o)&&s.push(new h(o,t,i))}return s}function w(){var e=document.createElement("div");e.id="show-shapes-overlay";var t={position:"absolute",top:"0",left:"0",zIndex:"1040"};m(e,t);var i=document.createElement("button");i.innerHTML="close",t={position:"fixed",top:"1em",right:"1em",background:"#1e90ff",border:"0",padding:"0.5em",color:"white",fontSize:"1.2em",borderRadius:"0.5em"},m(i,t),i.onclick=b;var s=document.createElement("canvas");s.id="show-shapes-canvas",t={opacity:"0.7"},m(s,t),e.appendChild(s),e.appendChild(i),document.body.appendChild(e),M=[],M=M.concat(v(document,window.pageXOffset,window.pageYOffset));for(var n,r,o=document.querySelectorAll("iframe"),a=0;o.length>a;a++)n=o[a],r=n.getBoundingClientRect(),M=M.concat(v(n.contentDocument,r.left+window.pageXOffset+n.clientLeft,r.top+window.pageYOffset+n.clientTop));window.addEventListener("resize",y,!1),y()}function T(){window.removeEventListener("resize",y);var e=document.getElementById("show-shapes-overlay");document.body.removeChild(e),M=[]}e.prototype.parseUrl=function(e){var t=/url\(.*\)/.exec(e);return t?t[0]:null},e.prototype.parseBox=function(e,s,n,r,o){var a=/margin-box|border-box|padding-box|content-box/.exec(e);if(!a)return null;a=a[0];var h={text:a,x:s.x,y:s.y,width:s.width,height:s.height,radii:JSON.parse(JSON.stringify(s.radii))};switch(a){case"content-box":t(h,-1,[o,r]),i(h.radii,-1,[o,r]);break;case"padding-box":t(h,-1,[r]),i(h.radii,-1,[r]);break;case"border-box":break;case"margin-box":t(h,1,[n]),i(h.radii,1,[n])}return h},e.prototype.printShape=function(){if(this.shape)switch(this.shape.type){case"inset":return"inset("+this.shape.insets.join(" ")+" round "+s(this.shape.radii,0).join(" ")+" / "+s(this.shape.radii,1).join(" ")+")";case"circle":return"circle("+this.shape.r+" at "+this.shape.cx+" "+this.shape.cy+")";case"ellipse":return"ellipse("+this.shape.rx+" "+this.shape.ry+" at "+this.shape.cx+" "+this.shape.cy+")";case"polygon":return"polygon("+this.shape.fillRule+", "+this.shape.points.map(function(e){return e.x+" "+e.y}).join(", ")+")";default:return"not yet implemented for "+this.shape.type}return"no shape specified"},e.prototype.printBox=function(){return this.box?this.box.text+" { x: "+this.box.x+", y: "+this.box.y+", width: "+this.box.width+", height: "+this.box.height+", radii: "+s(this.box.radii,0).join(" ")+" / "+s(this.box.radii,1).join(" ")+" }":"no box specified"},e.prototype.parseBasicShape=function(e,t,i){var s=/(inset|circle|ellipse|polygon)\((.*)\)/.exec(e);if(!s)return null;var n=s[1],r=s[2]?s[2]:"";switch(n){case"inset":return this.parseInset(r,t,i);case"circle":return this.parseCircle(r,t,i);case"ellipse":return this.parseEllipse(r,t,i);case"polygon":return this.parsePolygon(r,t,i);default:return null}},e.prototype.parseInset=function(e,t,i){var s=/((?:[^r]|r(?!o))*)?\s*(?:round\s+([^\/]*)(?:\s*\/\s*(.*))?)?/;e=s.exec(e);var r={type:"inset",insets:[0,0,0,0],radii:[[0,0],[0,0],[0,0],[0,0]]};if(e&&e[1]){var o=e[1].trim();o=o.split(/\s+/),r.insets[0]=o[0],r.insets[1]=o.length>1?o[1]:r.insets[0],r.insets[2]=o.length>2?o[2]:r.insets[0],r.insets[3]=o.length>3?o[3]:r.insets[1],r.insets[0]=n(r.insets[0],t.height,i),r.insets[1]=n(r.insets[1],t.width,i),r.insets[2]=n(r.insets[2],t.height,i),r.insets[3]=n(r.insets[3],t.width,i)}var a;return e&&e[2]&&(a=e[2].trim(),a=a.split(/\s+/),2>a.length&&a.push(a[0]),3>a.length&&a.push(a[0]),4>a.length&&a.push(a[1]),r.radii=a.map(function(e){return e=n(e,t.width,i),[e,e]})),e&&e[3]&&(a=e[3].trim(),a=a.split(/\s+/),2>a.length&&a.push(a[0]),3>a.length&&a.push(a[0]),4>a.length&&a.push(a[1]),a.forEach(function(e,s){r.radii[s][1]=n(e,t.height,i)})),r.x=r.insets[3],r.y=r.insets[0],r.width=t.width-(r.insets[1]+r.insets[3]),r.height=t.height-(r.insets[0]+r.insets[2]),r},e.prototype.parseEllipsoid=function(e){var t=/((?:[^a]|a(?!t))*)?\s*(?:at\s+(.*))?/;e=t.exec(e);var i={};if(e&&e[1]){var s=e[1].trim();s=s.split(/\s+/),i.rx=s[0],i.ry=s.length>1?s[1]:s[0]}else i.rx=i.ry="closest-side";var n=[];if(e&&e[2]){var r=e[2].trim();r=r.split(/\s+/);var o=!1;r.forEach(function(e){/\d+/.test(e)&&o?n[n.length-1]+=" "+e:n.push(e),o=/top|bottom|left|right/.test(e)&&r.length>2})}for(;2>n.length;)n.push("center");if(/top|bottom/.test(n[0])||/left|right/.test(n[1])){var a=n[0];n[0]=n[1],n[1]=a}return i.cx=n[0],i.cy=n[1],i},e.prototype.parseCircle=function(e,t,i){var s=this.parseEllipsoid(e);return s.type="circle",s.cx=r(s.cx,t.width,i),s.cy=r(s.cy,t.height,i),s.r=o(s.rx,[Math.abs(s.cx),Math.abs(t.width-s.cx),Math.abs(s.cy),Math.abs(t.height-s.cy)],Math.sqrt((t.width*t.width+t.height*t.height)/2),i),delete s.rx,delete s.ry,s},e.prototype.parseEllipse=function(e,t,i){var s=this.parseEllipsoid(e);return s.type="ellipse",s.cx=r(s.cx,t.width,i),s.cy=r(s.cy,t.height,i),s.rx=o(s.rx,[Math.abs(s.cx),Math.abs(t.width-s.cx)],t.width,i),s.ry=o(s.ry,[Math.abs(s.cy),Math.abs(t.height-s.cy)],t.height,i),s},e.prototype.parsePolygon=function(e,t,i){e=e.split(/\s*,\s*/);var s="nonzero";e.length>0&&/nonzero|evenodd/.test(e[0])&&(s=e[0].trim(),e=e.slice(1));var r=e.map(function(e){var s=e.split(/\s+/);return{x:n(s[0],t.width,i),y:n(s[1],t.height,i)}});return{type:"polygon",fillRule:s,points:r}};var S=["shapeInside","webkitShapeInside"],B=["shapeOutside","webkitShapeOutside"];h.hasShapes=function(e){var t=getComputedStyle(e);if(!t)return!1;var i=p(S,t),s=p(B,t);return i&&"none"!==i||s&&"none"!==s},h.prototype.getShapeInside=l(S),h.prototype.getShapeOutside=l(B),h.prototype.generateUnitsMap=function(){var e=["em","ex","ch","rem","vw","vh","vmin","vmax","cm","mm","in","px","pt","pc"],t=document.createElement("div");this.elem.appendChild(t);var i=getComputedStyle(t),s={};return e.forEach(function(e){t.style.fontSize="1"+e,s[e]=parseFloat(i.fontSize)}),this.elem.removeChild(t),s},h.prototype.generateBounds=function(e,t){var i=this.elem.getBoundingClientRect();return i={x:i.left+e,y:i.top+t,width:i.width,height:i.height}};var M=[],C=!1;return{toggleOverlay:b,ShapeInfo:h,ShapeValue:e}}();